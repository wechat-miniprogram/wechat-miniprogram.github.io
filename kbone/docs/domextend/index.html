<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>dom/bom 扩展 API | wechat-miniprogram / kbone</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="shortcut icon" href="/kbone/docs/favicon.ico">
    <meta name="description" content="Web 与小程序同构解决方案">
    <link rel="preload" href="/kbone/docs/assets/css/0.styles.5fe55a9a.css" as="style"><link rel="preload" href="/kbone/docs/assets/js/app.9112321a.js" as="script"><link rel="preload" href="/kbone/docs/assets/js/2.53eaa792.js" as="script"><link rel="preload" href="/kbone/docs/assets/js/22.46c21550.js" as="script"><link rel="prefetch" href="/kbone/docs/assets/js/10.0913ef21.js"><link rel="prefetch" href="/kbone/docs/assets/js/11.5067ecdb.js"><link rel="prefetch" href="/kbone/docs/assets/js/12.c5d99837.js"><link rel="prefetch" href="/kbone/docs/assets/js/13.c2421605.js"><link rel="prefetch" href="/kbone/docs/assets/js/14.7952af90.js"><link rel="prefetch" href="/kbone/docs/assets/js/15.8813abe6.js"><link rel="prefetch" href="/kbone/docs/assets/js/16.4ba4430c.js"><link rel="prefetch" href="/kbone/docs/assets/js/17.5bace26b.js"><link rel="prefetch" href="/kbone/docs/assets/js/18.6cd52bc8.js"><link rel="prefetch" href="/kbone/docs/assets/js/19.39015760.js"><link rel="prefetch" href="/kbone/docs/assets/js/20.9da3b002.js"><link rel="prefetch" href="/kbone/docs/assets/js/21.5078e2b7.js"><link rel="prefetch" href="/kbone/docs/assets/js/23.42026f54.js"><link rel="prefetch" href="/kbone/docs/assets/js/24.385dadd4.js"><link rel="prefetch" href="/kbone/docs/assets/js/25.7af74c2d.js"><link rel="prefetch" href="/kbone/docs/assets/js/26.21375be0.js"><link rel="prefetch" href="/kbone/docs/assets/js/27.f3df7365.js"><link rel="prefetch" href="/kbone/docs/assets/js/28.2efb64db.js"><link rel="prefetch" href="/kbone/docs/assets/js/29.3eb52512.js"><link rel="prefetch" href="/kbone/docs/assets/js/3.3f334b9b.js"><link rel="prefetch" href="/kbone/docs/assets/js/30.ac1c4380.js"><link rel="prefetch" href="/kbone/docs/assets/js/31.1853ae7b.js"><link rel="prefetch" href="/kbone/docs/assets/js/32.df983dca.js"><link rel="prefetch" href="/kbone/docs/assets/js/33.533c68fd.js"><link rel="prefetch" href="/kbone/docs/assets/js/34.2702daa9.js"><link rel="prefetch" href="/kbone/docs/assets/js/35.6a3a4c27.js"><link rel="prefetch" href="/kbone/docs/assets/js/36.e1aaef1b.js"><link rel="prefetch" href="/kbone/docs/assets/js/37.0f2e5f5d.js"><link rel="prefetch" href="/kbone/docs/assets/js/38.6d6261a2.js"><link rel="prefetch" href="/kbone/docs/assets/js/39.97628d50.js"><link rel="prefetch" href="/kbone/docs/assets/js/4.723323cf.js"><link rel="prefetch" href="/kbone/docs/assets/js/40.cee2230b.js"><link rel="prefetch" href="/kbone/docs/assets/js/41.76d3bc9d.js"><link rel="prefetch" href="/kbone/docs/assets/js/42.804da651.js"><link rel="prefetch" href="/kbone/docs/assets/js/43.05bb69ee.js"><link rel="prefetch" href="/kbone/docs/assets/js/44.4da8a2bc.js"><link rel="prefetch" href="/kbone/docs/assets/js/45.94da242d.js"><link rel="prefetch" href="/kbone/docs/assets/js/46.ef24662c.js"><link rel="prefetch" href="/kbone/docs/assets/js/47.0fbb6d6d.js"><link rel="prefetch" href="/kbone/docs/assets/js/48.b94b840c.js"><link rel="prefetch" href="/kbone/docs/assets/js/49.9a38f037.js"><link rel="prefetch" href="/kbone/docs/assets/js/5.b8ad3d45.js"><link rel="prefetch" href="/kbone/docs/assets/js/50.21470d50.js"><link rel="prefetch" href="/kbone/docs/assets/js/51.e7b0282a.js"><link rel="prefetch" href="/kbone/docs/assets/js/52.f664887e.js"><link rel="prefetch" href="/kbone/docs/assets/js/53.2012e401.js"><link rel="prefetch" href="/kbone/docs/assets/js/54.c1451592.js"><link rel="prefetch" href="/kbone/docs/assets/js/6.aaa0a515.js"><link rel="prefetch" href="/kbone/docs/assets/js/7.a81662b2.js"><link rel="prefetch" href="/kbone/docs/assets/js/8.e86ada1d.js"><link rel="prefetch" href="/kbone/docs/assets/js/9.81b4bd8b.js">
    <link rel="stylesheet" href="/kbone/docs/assets/css/0.styles.5fe55a9a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kbone/docs/" class="home-link router-link-active"><img src="/kbone/docs/logo.svg" alt="wechat-miniprogram / kbone" class="logo"> <span class="site-name can-hide">wechat-miniprogram / kbone</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kbone/docs/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/kbone/docs/config/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="/kbone/docs/domextend/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  dom/bom 扩展 API
</a></div><div class="nav-item"><a href="/kbone/docs/qa/" class="nav-link">
  Q&amp;A
</a></div><div class="nav-item"><a href="/kbone/docs/changelog/" class="nav-link">
  更新日志
</a></div><div class="nav-item"><a href="/kbone/docs/ui/intro/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kbone-ui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wechat-miniprogram/kbone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://developers.weixin.qq.com/community/minihome/mixflow/1213301129006825473" target="_blank" rel="noopener noreferrer" class="nav-link external">
  社区
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kbone/docs/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/kbone/docs/config/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="/kbone/docs/domextend/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  dom/bom 扩展 API
</a></div><div class="nav-item"><a href="/kbone/docs/qa/" class="nav-link">
  Q&amp;A
</a></div><div class="nav-item"><a href="/kbone/docs/changelog/" class="nav-link">
  更新日志
</a></div><div class="nav-item"><a href="/kbone/docs/ui/intro/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kbone-ui
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wechat-miniprogram/kbone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://developers.weixin.qq.com/community/minihome/mixflow/1213301129006825473" target="_blank" rel="noopener noreferrer" class="nav-link external">
  社区
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/kbone/docs/domextend/" aria-current="page" class="active sidebar-link">dom/bom 扩展 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-对象" class="sidebar-link">window 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-miniprogram" class="sidebar-link">window.$$miniprogram</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-global" class="sidebar-link">window.$$global</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-trigger" class="sidebar-link">window.$$trigger</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-clearevent" class="sidebar-link">window.$$clearEvent</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-getcomputedstyle" class="sidebar-link">window.$$getComputedStyle</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-createselectorquery" class="sidebar-link">window.$$createSelectorQuery</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-createintersectionobserver" class="sidebar-link">window.$$createIntersectionObserver</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-getopenereventchannel" class="sidebar-link">window.$$getOpenerEventChannel</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-forcerender" class="sidebar-link">window.$$forceRender</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-getprototype" class="sidebar-link">window.$$getPrototype</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-extend" class="sidebar-link">window.$$extend</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-addaspect" class="sidebar-link">window.$$addAspect</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-removeaspect" class="sidebar-link">window.$$removeAspect</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-subscribe" class="sidebar-link">window.$$subscribe</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-unsubscribe" class="sidebar-link">window.$$unsubscribe</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-publish" class="sidebar-link">window.$$publish</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-onshareappmessage" class="sidebar-link">window.onShareAppMessage</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-onsharetimeline" class="sidebar-link">window.onShareTimeline</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-onaddtofavorites" class="sidebar-link">window.onAddToFavorites</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-ontabitemtap" class="sidebar-link">window.onTabItemTap</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-ondealwithnotsupportdom" class="sidebar-link">window.onDealWithNotSupportDom</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-pagenotfound-事件" class="sidebar-link">window: pagenotfound 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-pageaccessdenied-事件" class="sidebar-link">window: pageaccessdenied 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-reachbottom-事件" class="sidebar-link">window: reachbottom 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-pulldownrefresh-事件" class="sidebar-link">window: pulldownrefresh 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-wxload-事件" class="sidebar-link">window: wxload 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-wxshow-事件" class="sidebar-link">window: wxshow 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-wxready-事件" class="sidebar-link">window: wxready 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-wxhide-事件" class="sidebar-link">window: wxhide 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#window-wxunload-事件" class="sidebar-link">window: wxunload 事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#document-对象" class="sidebar-link">document 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#document-cookie" class="sidebar-link">document.$$cookie</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#document-trigger" class="sidebar-link">document.$$trigger</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#document-clearevent" class="sidebar-link">document.$$clearEvent</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#document-setcookie" class="sidebar-link">document.$$setCookie</a></li></ul></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-对象" class="sidebar-link">dom 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-wxcomponent" class="sidebar-link">dom.$$wxComponent</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-trigger" class="sidebar-link">dom.$$trigger</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-clearevent" class="sidebar-link">dom.$$clearEvent</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-getboundingclientrect" class="sidebar-link">dom.$$getBoundingClientRect</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-getcontext" class="sidebar-link">dom.$$getContext</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-getnodesref" class="sidebar-link">dom.$$getNodesRef</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-domnodeupdate-事件" class="sidebar-link">dom: $$domNodeUpdate 事件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#dom-childnodesupdate-事件" class="sidebar-link">dom: $$childNodesUpdate 事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#canvas" class="sidebar-link">canvas</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kbone/docs/domextend/#canvas-prepare" class="sidebar-link">canvas.$$prepare</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dom-bom-扩展-api"><a href="#dom-bom-扩展-api" class="header-anchor">#</a> dom/bom 扩展 API</h1> <p>为了更好地适配小程序端接口，此方案在原有的 dom 接口之上进行了扩展。</p> <h2 id="window-对象"><a href="#window-对象" class="header-anchor">#</a> window 对象</h2> <h3 id="window-miniprogram"><a href="#window-miniprogram" class="header-anchor">#</a> window.$$miniprogram</h3> <p>挂在 window 对象下的一个特殊对象，用于对页面作一些初始化工作（主要针对小程序页面路由相关）</p> <table><thead><tr><th>属性名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>window</td> <td>Object</td> <td>对象所属页面的 window 对象</td></tr> <tr><td>document</td> <td>Object</td> <td>对象所属页面的 document 对象</td></tr> <tr><td>config</td> <td>Object</td> <td>创建页面时传入的 config</td></tr></tbody></table> <ul><li>init(url)</li></ul> <p>初始化页面，如果需要页面跳转逻辑，则此方法必须被执行。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>url</td> <td>String</td> <td>页面初始 url</td></tr></tbody></table> <ul><li>getMatchRoute(pathname)</li></ul> <p>根据传入的 url pathname 来获取匹配的小程序页面路由。</p> <h3 id="window-global"><a href="#window-global" class="header-anchor">#</a> window.$$global</h3> <p>跨页面共享对象，所有页面的 window.$$global 均会指向同一个对象。</p> <h3 id="window-trigger"><a href="#window-trigger" class="header-anchor">#</a> window.$$trigger</h3> <p>触发当前节点事件。与 dispatchEvent 不同的是，$$trigger 不会触发事件的捕获、冒泡阶段，只对绑定在节点上的事件句柄按顺序执行一遍。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>eventName</td> <td>String</td> <td>事件名称</td></tr> <tr><td>options</td> <td>Object</td> <td>配置</td></tr> <tr><td>options.event</td> <td>Object</td> <td>事件句柄接收到的事件对象</td></tr> <tr><td>options.isCapture</td> <td>Boolean</td> <td>是否触发捕获事件句柄，默认是 false</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">$$trigger</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">$$trigger</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    event<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>CustomEvent</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    isCapture<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="window-clearevent"><a href="#window-clearevent" class="header-anchor">#</a> window.$$clearEvent</h3> <p>清空某个事件的所有句柄。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>eventName</td> <td>String</td> <td>事件名称</td></tr> <tr><td>isCapture</td> <td>Boolean</td> <td>是否清空捕获事件句柄，默认是 false</td></tr></tbody></table> <blockquote><p>PS：慎用此方法，因为会清理掉所有地方绑定的事件句柄。</p></blockquote> <h3 id="window-getcomputedstyle"><a href="#window-getcomputedstyle" class="header-anchor">#</a> window.$$getComputedStyle</h3> <p>小程序中 window.getComputedStyle 的替代实现，返回一个 promise。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>dom</td> <td>String</td> <td>dom 节点</td></tr> <tr><td>computedStyle</td> <td>Array&lt;String&gt;</td> <td>指定样式名列表</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">$$getComputedStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'backgroundColor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>backgroundColor<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

window<span class="token punctuation">.</span><span class="token function">$$getComputedStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'backgroundColor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>backgroundColor<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="window-createselectorquery"><a href="#window-createselectorquery" class="header-anchor">#</a> window.$$createSelectorQuery</h3> <p>相当于 wx.createSelectorQuery，用法可参考<a href="https://developers.weixin.qq.com/miniprogram/dev/api/wxml/wx.createSelectorQuery.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="window-createintersectionobserver"><a href="#window-createintersectionobserver" class="header-anchor">#</a> window.$$createIntersectionObserver</h3> <p>相当于 wx.createIntersectionObserver，用法可参考<a href="https://developers.weixin.qq.com/miniprogram/dev/api/wxml/wx.createIntersectionObserver.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="window-getopenereventchannel"><a href="#window-getopenereventchannel" class="header-anchor">#</a> window.$$getOpenerEventChannel</h3> <p>相当于页面的 this.getOpenerEventChannel，用法可参考<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#%E9%A1%B5%E9%9D%A2%E9%97%B4%E9%80%9A%E4%BF%A1" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <blockquote><p>PS：一般来说，页面间通信可直接通过 <a href="#window-subscribe">window.$$subscribe</a> 和 <a href="#window-publish">window.$$publish</a> 来处理。只有对非插件页面和插件页面通信或者非 kbone 页面和 kbone 页面通信等特殊情况需要通过 eventChannel 的方式进行处理。</p></blockquote> <h3 id="window-forcerender"><a href="#window-forcerender" class="header-anchor">#</a> window.$$forceRender</h3> <p>强制清空 setData 队列进行渲染。</p> <h3 id="window-getprototype"><a href="#window-getprototype" class="header-anchor">#</a> window.$$getPrototype</h3> <p>获取 dom/bom 对象的原型，用于对其做一些扩展改造。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>descriptor</td> <td>String</td> <td>描述字符串</td></tr></tbody></table> <p>描述字符串支持的列表如下：</p> <ul><li>window.location</li> <li>window.navigator</li> <li>window.performance</li> <li>window.screen</li> <li>window.history</li> <li>window.localStorage</li> <li>window.sessionStorage</li> <li>window.event</li> <li>window</li> <li>document</li> <li>element.attribute</li> <li>element.classList</li> <li>element.style</li> <li>element</li> <li>textNode</li> <li>comment</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> locationPrototype <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">$$getPrototype</span><span class="token punctuation">(</span><span class="token string">'window.location'</span><span class="token punctuation">)</span> <span class="token comment">// location 对象的 prototype</span>

<span class="token keyword">const</span> elementPrototype <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">$$getPrototype</span><span class="token punctuation">(</span><span class="token string">'element'</span><span class="token punctuation">)</span> <span class="token comment">// 普通节点的 prototype</span>
<span class="token keyword">const</span> textNodePrototype <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">$$getPrototype</span><span class="token punctuation">(</span><span class="token string">'textNode'</span><span class="token punctuation">)</span> <span class="token comment">// 文本节点的 prototype</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="window-extend"><a href="#window-extend" class="header-anchor">#</a> window.$$extend</h3> <p>对 dom/bom 对象进行扩展。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>descriptor</td> <td>String</td> <td>描述字符串，值同 <a href="#window-getprototype">window.$$getPrototype</a> 接口</td></tr> <tr><td>options</td> <td>Object</td> <td>扩展对象</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 对 location 对象进行扩展</span>
window<span class="token punctuation">.</span><span class="token function">$$extend</span><span class="token punctuation">(</span><span class="token string">'window.location'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    testStr<span class="token operator">:</span> <span class="token string">'I am location'</span><span class="token punctuation">,</span>
    <span class="token function">testFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>testStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">testFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出 Hello, I am location</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="window-addaspect"><a href="#window-addaspect" class="header-anchor">#</a> window.$$addAspect</h3> <p>对 dom/bom 对象方法追加前置/后置处理。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>descriptor</td> <td>String</td> <td>描述字符串</td></tr> <tr><td>func</td> <td>Function</td> <td>处理方法</td></tr></tbody></table> <p>描述字符串的值类似 <a href="#window-getprototype">window.$$getPrototype</a> 接口的描述字符串，只是后续追加了方法和类型，比如 <code>element.hasChildNodes.before</code> 即表示在 element.hasChildNodes 方法追加前置处理。</p> <p>前置处理即表示此方法会在执行原始方法之前执行，后置处理则是在之后执行。前置处理方法接收到的参数和原始方法接收到的参数一致，后置处理方法接收到的参数则是原始方法执行后返回的结果。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
div<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">const</span> <span class="token function-variable function">beforeAspect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在执行 div.hasChildNodes 前被调用</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token comment">// 输出调用 div.hasChildNodes 时传入的参数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">===</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// 如果返回 true，则中断方法执行，不会再执行原始方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">afterAspect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在执行 div.hasChildNodes 后被调用</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 输出调用 div.hasChildNodes 的返回值</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">$$addAspect</span><span class="token punctuation">(</span><span class="token string">'element.hasChildNodes.before'</span><span class="token punctuation">,</span> beforeAspect<span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">$$addAspect</span><span class="token punctuation">(</span><span class="token string">'element.hasChildNodes.after'</span><span class="token punctuation">,</span> afterAspect<span class="token punctuation">)</span>
div<span class="token punctuation">.</span><span class="token function">hasChildNodes</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span> <span class="token comment">// 返回 false</span>
div<span class="token punctuation">.</span>count <span class="token comment">// 输出 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="window-removeaspect"><a href="#window-removeaspect" class="header-anchor">#</a> window.$$removeAspect</h3> <p>移除对 dom/bom 对象方法追加前置/后置处理。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>descriptor</td> <td>String</td> <td>描述字符串，值同 <a href="#window-addaspect">window.$$addAspect</a> 接口</td></tr> <tr><td>func</td> <td>Function</td> <td>处理方法</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">$$removeAspect</span><span class="token punctuation">(</span><span class="token string">'element.hasChildNodes.before'</span><span class="token punctuation">,</span> beforeAspect<span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">$$removeAspect</span><span class="token punctuation">(</span><span class="token string">'element.hasChildNodes.after'</span><span class="token punctuation">,</span> afterAspect<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="window-subscribe"><a href="#window-subscribe" class="header-anchor">#</a> window.$$subscribe</h3> <p>订阅来自 window 对象发布的广播消息。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>name</td> <td>String</td> <td>消息名称</td></tr> <tr><td>handler</td> <td>Function</td> <td>事件句柄</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">$$subscribe</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'receive a msg: '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="window-unsubscribe"><a href="#window-unsubscribe" class="header-anchor">#</a> window.$$unsubscribe</h3> <p>取消订阅来自 window 对象发布的广播消息。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>name</td> <td>String</td> <td>消息名称</td></tr> <tr><td>handler</td> <td>Function</td> <td>事件句柄，如果不传则会清除关于此消息的所有事件句柄</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'receive a msg: '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">$$unsubscribe</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token comment">// 取消当前订阅</span>
window<span class="token punctuation">.</span><span class="token function">$$unsubscribe</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span> <span class="token comment">// 取消关于此消息的所有订阅</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="window-publish"><a href="#window-publish" class="header-anchor">#</a> window.$$publish</h3> <p>发布广播消息，所有订阅过此消息的 window 对象均会收到。</p> <table><thead><tr><th>参数</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>name</td> <td>String</td> <td>消息名称</td></tr> <tr><td>data</td> <td>Any</td> <td>数据</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">$$publish</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'I am june'</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">$$publish</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'june'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="window-onshareappmessage"><a href="#window-onshareappmessage" class="header-anchor">#</a> window.onShareAppMessage</h3> <p>开启 share 配置后，当进行页面转发时会执行的回调。此回调可以返回一个对象，作为小程序处理转发的参数。</p> <table><thead><tr><th>属性名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>data</td> <td>Object</td> <td>小程序被转发页面 onShareAppMessage 回调传入的参数，可参考<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareAppMessage-Object-object" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr></tbody></table> <p>返回对象中除了官方支持的参数外，还支持额外的参数：</p> <table><thead><tr><th>属性名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>miniprogramPath</td> <td>String</td> <td>默认传入的 path 会被改造成 kbone 能解析的路径，如果需要转发原始的小程序页面路由，可传入此参数</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onShareAppMessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当页面被转发时会进入这个回调</span>
    <span class="token comment">// 返回一个对象，作为小程序处理转发的参数，对象内容和小程序页面 onShareAppMessage 回调可返回对象内容基本一致，具体可参考官方文档：https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareAppMessage-Object-object</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'test title'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token comment">// 当前页面，这里的 path 是页面 url，而不是小程序路由</span>
        <span class="token comment">// path: 'https://test.miniprogram.com/a', // 当前页面的完整 url，同上</span>
        <span class="token comment">// path: '/b', // 其他页面，同上</span>
        <span class="token comment">// path: 'https://test.miniprogram.com/b', // 其他页面的完整 url，同上</span>
        <span class="token comment">// miniprogramPath: `/pages/page2/index?type=share&amp;targeturl=${encodeURIComponent('/b')}`, // 如果需要分享原始小程序页面路由，可传递此参数</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>PS：返回的对象中，path 是要转发页面的 url（支持跨页面转发），而不是页面路由。如果不返回默认取 window.locaiton.href。</p></blockquote> <blockquote><p>PS：miniprogramPath 的组装方式可参考 <a href="/kbone/docs/qa/#答疑">QA 说明</a>。</p></blockquote> <h3 id="window-onsharetimeline"><a href="#window-onsharetimeline" class="header-anchor">#</a> window.onShareTimeline</h3> <p>开启 shareTimeline 配置后，当进行页面分享朋友圈时会执行的回调。此回调可以返回一个对象，作为小程序处理分享朋友圈的参数。</p> <p>返回对象中除了官方支持的参数外，还支持额外的参数：</p> <table><thead><tr><th>属性名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>miniprogramQuery</td> <td>String</td> <td>默认传入的 query 会被改造成 kbone 能解析的参数，如果需要转发原始的小程序页面参数，可传入此参数</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onShareTimeline</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当页面被分享朋友圈时会进入这个回调</span>
    <span class="token comment">// 返回一个对象，作为小程序处理分享朋友圈的参数，对象内容和小程序页面 onShareTimeline 回调可返回对象内容基本一致，具体可参考官方文档：https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareTimeline</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'test title'</span><span class="token punctuation">,</span>
        query<span class="token operator">:</span> <span class="token string">'a=123&amp;b=321'</span><span class="token punctuation">,</span> <span class="token comment">// 这里的 query 是页面 url 中的 search 参数，而不是小程序路由中的参数</span>
        <span class="token comment">// miniprogramQuery: `type=share&amp;targeturl=${encodeURIComponent('/a?a=123&amp;b=321')}`, // 如果需要分享原始小程序页面路由参数，可传递此参数</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>PS：返回的对象中，query 是要转发页面的 search，而不是页面路由参数。如果不返回默认取 locaiton.search。</p></blockquote> <blockquote><p>PS：miniprogramPath 的组装方式可参考 <a href="/kbone/docs/qa/#答疑">QA 说明</a>。</p></blockquote> <h3 id="window-onaddtofavorites"><a href="#window-onaddtofavorites" class="header-anchor">#</a> window.onAddToFavorites</h3> <p>当页面被收藏时会执行的回调。此回调可以返回一个对象，作为小程序处理收藏的参数。</p> <table><thead><tr><th>属性名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>data</td> <td>Object</td> <td>小程序被转发页面 onAddToFavorites 回调传入的参数，可参考<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onAddToFavorites-Object-object" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr></tbody></table> <p>返回对象中除了官方支持的参数外，还支持额外的参数：</p> <table><thead><tr><th>属性名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>miniprogramQuery</td> <td>String</td> <td>默认传入的 query 会被改造成 kbone 能解析的参数，如果需要转发原始的小程序页面参数，可传入此参数</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onAddToFavorites</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当页面被收藏时会进入这个回调</span>
    <span class="token comment">// 返回一个对象，作为小程序处理收藏的参数，对象内容和小程序页面 onAddToFavorites 回调可返回对象内容基本一致，具体可参考官方文档：https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onAddToFavorites-Object-object</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'test title'</span><span class="token punctuation">,</span>
        query<span class="token operator">:</span> <span class="token string">'a=123&amp;b=321'</span><span class="token punctuation">,</span> <span class="token comment">// 这里的 query 是页面 url 中的 search 参数，而不是小程序路由中的参数</span>
        <span class="token comment">// miniprogramQuery: `type=share&amp;targeturl=${encodeURIComponent('/a?a=123&amp;b=321')}`, // 如果需要收藏原始小程序页面路由参数，可传递此参数</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>PS：返回的对象中，query 是要转发页面的 search，而不是页面路由参数。如果不返回默认取 locaiton.search。</p></blockquote> <blockquote><p>PS：miniprogramPath 的组装方式可参考 <a href="/kbone/docs/qa/#答疑">QA 说明</a>。</p></blockquote> <h3 id="window-ontabitemtap"><a href="#window-ontabitemtap" class="header-anchor">#</a> window.onTabItemTap</h3> <p>tabbar 被点击时会执行的回调，详情可参考<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onTabItemTap-Object-object" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="window-ondealwithnotsupportdom"><a href="#window-ondealwithnotsupportdom" class="header-anchor">#</a> window.onDealWithNotSupportDom</h3> <p>渲染时遇到不支持的 dom 节点会执行的回调。</p> <table><thead><tr><th>属性名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>dom</td> <td>Object</td> <td>不支持的 dom 节点</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onDealWithNotSupportDom</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 渲染时遇到不支持的 dom 节点时会进入这个回调</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dom<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">'IFRAME'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dom<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'当前小程序版本暂不支持 iframe'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="window-pagenotfound-事件"><a href="#window-pagenotfound-事件" class="header-anchor">#</a> window: pagenotfound 事件</h3> <p>当跳转到一个不存在的页面时触发。</p> <ul><li>event.type：页面跳转类型，jump 表示当前页面跳转，open 表示新开页面</li> <li>event.url：目标页面的 url</li></ul> <h3 id="window-pageaccessdenied-事件"><a href="#window-pageaccessdenied-事件" class="header-anchor">#</a> window: pageaccessdenied 事件</h3> <p>当跳转到一个被禁止访问的页面时触发，通常跳转非同源页面时会触发。</p> <ul><li>event.type: 页面跳转类型，jump 表示当前页面跳转，open 表示新开页面</li> <li>event.url: 目标页面的 url</li></ul> <h3 id="window-reachbottom-事件"><a href="#window-reachbottom-事件" class="header-anchor">#</a> window: reachbottom 事件</h3> <p>开启 reachBottom 配置后，当页面上拉触底时会触发此事件。</p> <h3 id="window-pulldownrefresh-事件"><a href="#window-pulldownrefresh-事件" class="header-anchor">#</a> window: pulldownrefresh 事件</h3> <p>开启 pullDownRefresh 配置后，当下拉刷新页面时会触发此事件。</p> <h3 id="window-wxload-事件"><a href="#window-wxload-事件" class="header-anchor">#</a> window: wxload 事件</h3> <p>即小程序页面的 onLoad 生命周期回调。</p> <h3 id="window-wxshow-事件"><a href="#window-wxshow-事件" class="header-anchor">#</a> window: wxshow 事件</h3> <p>即小程序页面的 onShow 生命周期回调。</p> <h3 id="window-wxready-事件"><a href="#window-wxready-事件" class="header-anchor">#</a> window: wxready 事件</h3> <p>即小程序页面的 onReady 生命周期回调。</p> <h3 id="window-wxhide-事件"><a href="#window-wxhide-事件" class="header-anchor">#</a> window: wxhide 事件</h3> <p>即小程序页面的 onHide 生命周期回调。</p> <h3 id="window-wxunload-事件"><a href="#window-wxunload-事件" class="header-anchor">#</a> window: wxunload 事件</h3> <p>即小程序页面的 onUnload 生命周期回调。</p> <h2 id="document-对象"><a href="#document-对象" class="header-anchor">#</a> document 对象</h2> <h3 id="document-cookie"><a href="#document-cookie" class="header-anchor">#</a> document.$$cookie</h3> <p>获取完整的 cookie，相当于请求头附带的 cookie。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 给请求头设置 cookie</span>
wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">'/cgi/xxx'</span><span class="token punctuation">,</span>
    header<span class="token operator">:</span> <span class="token punctuation">{</span>
        cookie<span class="token operator">:</span> window<span class="token punctuation">.</span>document<span class="token punctuation">.</span>$$cookie<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="document-trigger"><a href="#document-trigger" class="header-anchor">#</a> document.$$trigger</h3> <p>同 <a href="#window-trigger">window.$$trigger</a>。</p> <h3 id="document-clearevent"><a href="#document-clearevent" class="header-anchor">#</a> document.$$clearEvent</h3> <p>同 <a href="#window-clearevent">window.$$clearEvent</a>。</p> <blockquote><p>PS：慎用此方法，因为会清理掉所有地方绑定的事件句柄。</p></blockquote> <h3 id="document-setcookie"><a href="#document-setcookie" class="header-anchor">#</a> document.$$setCookie</h3> <p>处理 wx.request 返回的 Set-Cookie 头，并存入 document.cookie 中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">'/cgi/xxx'</span><span class="token punctuation">,</span>
    <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> setCookie <span class="token operator">=</span> res<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">'Set-Cookie'</span><span class="token punctuation">]</span>
        document<span class="token punctuation">.</span><span class="token function">$$setCookie</span><span class="token punctuation">(</span>setCookie<span class="token punctuation">)</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="dom-对象"><a href="#dom-对象" class="header-anchor">#</a> dom 对象</h2> <h3 id="dom-wxcomponent"><a href="#dom-wxcomponent" class="header-anchor">#</a> dom.$$wxComponent</h3> <p>获取该节点所属的小程序自定义组件实例。</p> <blockquote><p>PS：只有 dom.nodeType 为 1 的元素节点可获取。</p></blockquote> <h3 id="dom-trigger"><a href="#dom-trigger" class="header-anchor">#</a> dom.$$trigger</h3> <p>同 <a href="#window-trigger">window.$$trigger</a>。</p> <h3 id="dom-clearevent"><a href="#dom-clearevent" class="header-anchor">#</a> dom.$$clearEvent</h3> <p>同 <a href="#window-clearevent">window.$$clearEvent</a>。</p> <blockquote><p>PS：慎用此方法，因为会清理掉所有地方绑定的事件句柄。</p></blockquote> <h3 id="dom-getboundingclientrect"><a href="#dom-getboundingclientrect" class="header-anchor">#</a> dom.$$getBoundingClientRect</h3> <p>小程序中 dom.getBoundingClientRect 的替代实现，返回一个 promise。</p> <blockquote><p>PS：此接口本质上是小程序的 SelectorQuery 的二次封装，如果是 dom 是 document.body，会默认走 scrollOffset 接口，如果是其他 dom 则走 boundingClientRect 接口。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">$$getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// res 的内容可以参考官方文档：https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.scrollOffset.html</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$$getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// res 的内容可以参考官方文档：https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.boundingClientRect.html</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="dom-getcontext"><a href="#dom-getcontext" class="header-anchor">#</a> dom.$$getContext</h3> <p>获取小程序组件的 context 对象，返回一个 promise。</p> <blockquote><p>PS：此接口是小程序的 SelectorQuery 的二次封装</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$$getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里的 context 仅限于文档中支持的那些：https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.context.html</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="dom-getnodesref"><a href="#dom-getnodesref" class="header-anchor">#</a> dom.$$getNodesRef</h3> <p>获取小程序组件的 NodesRef 对象，返回一个 promise。</p> <blockquote><p>PS：此接口是小程序的 SelectorQuery 的二次封装</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$$getNodesRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">nodesRef</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// NodesRef 对象文档：https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.html</span>
    nodesRef<span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="dom-domnodeupdate-事件"><a href="#dom-domnodeupdate-事件" class="header-anchor">#</a> dom: $$domNodeUpdate 事件</h3> <p>当前节点有更新时触发。</p> <h3 id="dom-childnodesupdate-事件"><a href="#dom-childnodesupdate-事件" class="header-anchor">#</a> dom: $$childNodesUpdate 事件</h3> <p>儿子节点有更新时触发。</p> <blockquote><p>PS：注意此处孙子节点更新是不会触发的。</p></blockquote> <h2 id="canvas"><a href="#canvas" class="header-anchor">#</a> canvas</h2> <h3 id="canvas-prepare"><a href="#canvas-prepare" class="header-anchor">#</a> canvas.$$prepare</h3> <p>小程序 canvas 提供了和 Web 端接口对齐的 node 对象，此方法用于将该对象处理到 canvas 节点的 getContext 方法中。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>document.getElementById('#canvas').$$prepare().then(domNode =&gt; {
    const ctx = domNode.getContext('2d') // 注意，这种用法需要设置 canvas 节点的 type 属性，相关文档：https://developers.weixin.qq.com/miniprogram/dev/component/canvas.html
    
    // do something
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/kbone/docs/assets/js/app.9112321a.js" defer></script><script src="/kbone/docs/assets/js/2.53eaa792.js" defer></script><script src="/kbone/docs/assets/js/22.46c21550.js" defer></script>
  </body>
</html>
